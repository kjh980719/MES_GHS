<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mes.app.mapper.order.OrderMapper">
    <select id="Material_List_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  call Material_List_S1_Str (

            #{searchText},
            #{REMARKS_WIN},
            #{USE_YN},
            #{currentPage},
            #{rowsPerPage}
            )
        }
    </select>
    
    <select id="Order_Search_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  call Order_Search_S1_Str (
            #{startDate},
            #{endDate},
            #{REMARKS_WIN},
            #{ORDER_STATUS},
            #{BUSINESS_NO},
            #{currentPage},
            #{rowsPerPage} 
            )
        }
    </select>
    
    
    <select id="Product_Group_CD_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  call Product_Group_CD_S1_Str()
        }
    </select>
    <select id="Product_Group_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  call Product_Group_S1_Str()
        }
    </select>
    <select id="Product_CATEGORY__S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  call Product_CATEGORY__S1_Str()
        }
    </select>
    
    <select id="Order_Row_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  call Order_Row_S1_Str(#{ORDER_CODE})
        
        }
    </select>
	
	<select id="Order_Detail_Create_I1_Str" statementType="CALLABLE" parameterType="HashMap">
	    {call Order_Detail_Create_I1_Str(
            #{order_code},
            #{seq},
            #{pdt_cd},
            #{pdt_code},
            #{pdt_name},
            #{pdt_standard},
            #{qty},
            #{unit},
            #{unit_price},
            #{supply_price},
            #{vat}
	    )
	    }
    </select>
    
	<select id="Order_Create_I2_Str" statementType="CALLABLE" parameterType="HashMap" resultType="String">
	    {call Order_Create_I2_Str(
	    #{supply_manager_name},#{supply_phoneNumber},
	    #{manager_name},#{manager_phoneNumber},#{supply_amount},#{tax_amount},#{total_amount},#{bigo},
	   	#{order_date},#{close_date},#{post_no},#{order_addr},#{order_addr_info},#{cust_seq},#{regist_by} )
	    }

	</select>
	
	<select id="OrderMaterial_Row_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  
        call OrderMaterial_Row_S1_Str(#{ORDER_CODE})	
        }
    </select>
    
    <delete id="OrderMaterial_Delete_D1_Str" statementType="CALLABLE" parameterType="HashMap">
    
    	delete from order_material where ORDER_CODE = #{ORDER_CODE}
    	
    </delete>
    
     <update id="Order_Update_U1_Str" statementType="CALLABLE" parameterType="HashMap">
    	{
    	call Order_Update_U1_Str(#{ORDER_CODE},#{BUSINESS_NO},#{ORDER_DATE},#{PHONENUMBER},#{BIGO},#{CLOSE_DATE},#{MANAGER_NAME},
    	#{RECEPTION},#{SUPPLY_NAME},#{ORDER_ADDR},#{FAX_AMOUNT},#{TAX_AMOUNT},#{TOTAL_AMOUNT},#{JONGMOK})
    	}
    </update>
    
    <select id="SCM_CustRegist_Search_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  
        call SCM_CustRegist_Search_S1_Str(#{REMARKS_WIN},#{currentPage},
            #{rowsPerPage})	
        }
    </select>
    
     <select id="Order_Material_Search_S1_Str" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  
        call Order_Material_Search_S1_Str(#{REMARKS_WIN},#{currentPage},
            #{rowsPerPage})	
        }
    </select>
    
    
 
    
   <select id="orderList" parameterType="HashMap" resultType="Map">
	 {  call Order_Search_S1_Str (
        #{order_status},#{search_type},#{search_string},#{currentPage},#{rowsPerPage},#{startDate},#{endDate}
        )
     }	
    </select>
    
    
    <select id="orderInfo"  parameterType="HashMap" resultType="Map">

      	SELECT
      		A.order_seq as order_seq
      		,A.order_code as order_code
      		,IFNULL(A.manager_phoneNumber,'') as manager_phoneNumber
            ,convert(date_format(A.order_date, '%Y-%m-%d'), char(10)) as order_date
           	,convert(date_format(A.close_date, '%Y-%m-%d'), char(20)) as close_date
           	,IFNULL(TRUNCATE(a.TOTAL_AMOUNT,0),0) as total_amount
           	,IFNULL(TRUNCATE(A.SUPPLY_AMOUNT ,0),0)as supply_amount
            ,IFNULL(TRUNCATE(A.TAX_AMOUNT,0),0) as tax_amount
            ,IFNULL(A.manager_Name,'') as manager_name
            ,IFNULL(C.cust_name,'') as supply_name
            ,IFNULL(A.bigo ,'') as bigo
            ,IFNULL(A.order_status,'') as order_status
			,IFNULL(B.NO,'')   as no
			,IFNULL(B.PDT_CD,'') as pdt_cd
       	 	,IFNULL(B.PDT_CODE,'') as pdt_code
 			,IFNULL(B.PDT_NAME,'') as pdt_name
 			,IFNULL(B.PDT_STANDARD,'') AS pdt_standard
			,IFNULL(B.QTY,0) as qty
			,IFNULL(B.UNIT,'') as unit
            ,IFNULL(TRUNCATE(B.unit_price,2),0) as unit_price
            ,IFNULL(TRUNCATE(B.SUPPLY_PRICE,0),0) as supply_price
            ,IFNULL(TRUNCATE(B.VAT,0),0) as vat
            ,IFNULL(A.SUPPLY_MANAGER_NAME,'') as supply_manager_name
			,IFNULL(A.post_no,'') as post_no
			,IFNULL(A.order_addr,'') as order_addr
			,IFNULL(A.order_addr_info,'') as order_addr_info
            ,IFNULL(A.SUPPLY_PHONENUMBER,'') as supply_phoneNumber
            ,IFNULL(A.cancel_reason,'') as cancel_reason
      	    ,IFNULL(A.cust_seq,'') as cust_seq
       	 FROM mes_ordermaster A
       	    inner join mes_orderdetail B on A.order_code = B.order_code
      	    inner join cust C on A.cust_seq = C.cust_seq
         WHERE  A.order_seq = #{order_seq}

    </select>    
    
    <select id="getcustSearchListCustName"  parameterType="HashMap" resultType="Map">
    	select 
    		k.NO as no
    		,k.BUSINESS_NO as business_no
    		,IFNULL(k.SUPPLY_NAME,'') as supply_name
    		,IFNULL(k.BOSS_NAME,'') as boss_name
    		,IFNULL(k.TEL,'') as tel
    		,IFNULL(k.FAX,'') as fax
    	from 
    	(
    	select 
    		@ROWNUM:=@ROWNUM+1 AS NO
    		,business_no AS BUSINESS_NO
    		,supply_name AS SUPPLY_NAME
    		,boss_name	AS BOSS_NAME
    		,TEL AS TEL
    		,FAX AS FAX
    	from supply ,(SELECT @ROWNUM:=0) R 
    	where supply_name like ${wQuery}
    	)k	
    	<!-- WHERE k.No  BETWEEN ((#{currentPage}-1) * #{rowperPage}) + 1 AND #{currentPage} * #{rowperPage} -->


    </select>
    
       <update id="orderInfoUpdate" parameterType="HashMap">
      	    UPDATE mes_ordermaster SET
                order_status = #{order_status}
        		,manager_phonenumber = #{manager_phoneNumber}
                ,post_no = #{post_no}
        		,order_addr = #{order_addr}
                ,order_addr_info = #{order_addr_info}
        		,supply_manager_name = #{supply_manager_name}		
        		,supply_phonenumber = #{supply_phoneNumber}
        		,bigo = #{bigo}
        		,close_date = #{close_date}
      	        ,mod_by = ,#{mod_by}
      	        ,mod_date = now()
   			 WHERE
   				 order_seq = #{order_seq};
    </update>
    
    <select id="orderInfoUpdateCancel" statementType="CALLABLE" parameterType="HashMap" resultType="Map">
        {  
        call Order_Update_U2_Str(#{order_seq},#{close_date},#{order_status},#{cancel_reason},#{mod_by})
        }
    </select>
    
</mapper>
