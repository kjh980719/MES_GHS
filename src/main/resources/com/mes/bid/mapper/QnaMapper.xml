<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mes.app.mapper.board.QnaMapper">

    <select id="createReply" statementType="CALLABLE" parameterType="HashMap">
     	{  call Qna_Reply_Create_I1_Str (
            #{qna_seq},   
            #{title2},
            #{contents2},
            #{loginUserId},
            #{iLoginUserName},
            #{iLoginUserIp},
            #{file1}

            )
        }
    </select>
 	
 	<select id="editReply" statementType="CALLABLE" parameterType="HashMap" >
     	{  call Qna_Reply_Update_U1_Str (
           	#{qna_seq},   
            #{title2},
            #{contents2},
            #{loginUserId},
            #{iLoginUserName},
            #{iLoginUserIp},
            #{file1}
            )
        }
    </select>
 	
 	<select id="qnaList"  parameterType="HashMap" resultType="HashMap">
 		
 		SELECT * FROM (
			SELECT 
				@ROWNUM := @ROWNUM+1 AS no
				,k.QNA_SEQ AS qna_seq
				,k.CUST_SEQ AS cust_seq
				,k.CUST_NAME AS cust_name
				,k.TITLE AS title
				,k.CONTENTS AS contents
				,k.WRITERID AS writerId
				,k.WRITERNAME AS writerName
				,convert(date_format(k.REGDATE, '%Y-%m-%d'), char(10)) as regDate
				,k.REPLYYN AS replyYN
			FROM
			    (
					select 		
						A.QNA_SEQ			
						,A.CUST_SEQ		
						,B.CUST_NAME		
						,A.TITLE
						,A.CONTENTS
						,A.WRITERID
						,A.WRITERNAME
						,A.REGDATE
						,A.REPLYYN
					from qna A left outer join cust B on A.cust_seq = B.cust_seq,
					(SELECT @ROWNUM:=0) R
					where A.DELETEYN = 'N' 
						${sQuery}
						
						order by A.REGDATE desc
			        ) k
			)sub
			WHERE sub.no  BETWEEN ((#{currentPage}-1) * #{rowsPerPage}) + 1 AND #{currentPage} * #{rowsPerPage}
 		

 		
 	</select>
    
    <select id="qnaListTotal"  parameterType="HashMap" resultType="int">
       	SELECT
       	 	COUNT(*) 
       	from qna A	
       	WHERE A.DELETEYN = 'N'  
			${sQuery}

    </select>
   
   <select id="qnaInfo"  parameterType="HashMap" resultType="Map">

        	SELECT
      		A.QNA_SEQ as qna_seq
 			,A.CUST_SEQ as cust_seq
			,IFNULL(B.CUST_NAME,'')  as cust_name
 			,A.TITLE as title
			,A.CONTENTS as contents
			,A.DELETEYN as deleteYN
			,A.SHOWYN as showYN
			,IFNULL(A.WRITERID,'') as writerId
			,IFNULL(A.WRITERNAME,'') as writerName
			,IFNULL(A.WRITERIP,'') as writerIp
			,IFNULL(A.REPLYID,'') as modId
			,IFNULL(A.REPLYNAME,'') as modName
			,IFNULL(A.REPLYIP,'') as modIp
			,IFNULL(convert(date_format(A.REGDATE, '%Y-%m-%d'), char(10)),'') as regDate
			,IFNULL(convert(date_format(A.UPTDATE, '%Y-%m-%d'), char(10)),'') as uptDate
			,IFNULL(convert(date_format(A.DETDATE, '%Y-%m-%d'), char(10)),'') as detDate
			,IFNULL(convert(date_format(A.REPLYDATE, '%Y-%m-%d'), char(10)),'') as replyDate
			,A.TITLE2 as title2
			,A.CONTENTS2 as contents2
			,IFNULL(A.REPLYID,'') as replyId
			,IFNULL(A.REPLYNAME,'') as replyName
			,IFNULL(A.REPLYIP,'') as replyIp
			,A.REPLYYN as replyYN
       	 FROM qna A left outer join cust B on A.CUST_SEQ = B.CUST_SEQ 
         where A.qna_seq = #{qna_seq} 

    </select>   
   	
   	<select id="qnaFileListSql" parameterType="Map" resultType="java.util.LinkedHashMap">
	    select
	             b.file_key
	           , b.file_name
	           , b.file_path
	           , b.file_size
	           , b.file_date
	   from
	      qna a, file_info b
	   where
	      b.file_key in (a.file1)
	      and a.qna_seq = #{qna_seq}
	</select> 
	
	<select id="qnaFileListSql2" parameterType="Map" resultType="java.util.LinkedHashMap">
	    select
	             b.file_key
	           , b.file_name
	           , b.file_path
	           , b.file_size
	           , b.file_date
	   from
	      qna a, file_info b
	   where
	      b.file_key in (a.file2)
	      and a.qna_seq = #{qna_seq}
	</select> 
	
	<select id="deleteFile" statementType="CALLABLE" parameterType="HashMap" >
     	{  
     		call Qna_DeleteFile_D1_Str (#{qna_seq},#{type})
        }
    </select>
</mapper>
